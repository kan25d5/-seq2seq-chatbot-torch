# seq2seq-chatbot-torch
## Task
ツイッター上の会話データを学習し，発話から応答を自動生成するSeq2Seqモデルです．

## Dataset
Twitterコーパスとして利用したjsonファイルの中身は以下の通りになっています．

```json
[
    // 対話セット
    [
        // 対話（同一ツイートスレッド内）
        [
            // ツイートのやり取り（発話と応答のペア）
            {
                // 発話ツイート
                "text" : "aaaaaaaaaaaaaaaaaaaaa!!!",
                "screen_name" : "@AAAAAAAAA",
                "tweet_id" : 10934893023490
            },
            {
                // 応答ツイート
                "text" : "bbbbbbbbbbbbbbbbbbbbb!!!",
                "screen_name" : "@BBBBBBBB",
                "tweet_id" : 10934893023450
            },
            {
                // 次の発話ツイート（応答ツイートに対する応答）
                "text" : "ccccccccccccccccccccc!!!",
                "screen_name" : "@AAAAAAAAA",
                "tweet_id" : 10934893023423
            }
            // .....
        ]
        // ....
    ]
]
```

## 使用ライブラリ
- pytorch==1.11.0 
- pytorch-lightning==1.6.0 
- fugashi==1.1.2
- tensorflow==2.4.1
- gensim==4.1.2
- scikit-learn==1.0.2
- dill==0.3.4

## 実装したモデル
 - Encoder-Decoder
 - Encoder-Decoder + Attention
 - Transformer (main model)

## 応答予測の例
- 使用したデータセットに含まれるターン数（発話-応答のペアの個数）
  - train_dataset : 446,463
  - val_dataset : 137,047
  - test_dataset : 59,010
- トレーニングの詳細
  - BATCH SIZE : 100
  - EPOCH SIZE : 398
- タグについて
  - source : データセット中の発話 (Source sequence).
  - target : sourceに対するデータセット中の応答 (Target sequence).
  - preds : Greedy Decodingによるtarget予測の結果.
- dataloader_type ラベルについて
  - train : トレーニングに使用したデータによる応答予測.
  - test : テストデータによる応答予測（トレーニングに使用されていないデータ）.

## 性格コーパスによる学習
1. まず，対話コーパス中の応答文について極性分析を行い，Neutralの判定がされた応答文を含む対話ペアによって構成された対話コーパス（「事前学習コーパス」と呼ぶ）を作成する．次に事前学習コーパスを用いて，発話文から応答文への系列生成モデル（「事前学習モデル」と呼ぶ）を学習する．
1. Neutralの判定がされなかった応答文のうち，NegativeなしいはPositiveの同一な判定がされた対話ペアのみによって構成された対話データ（「性格コーパス」と呼ぶ）を作成する．次に，性格コーパスを用いて，事前学習モデルのパラメータで初期化された新たな系列生成モデル（「性格モデル」と呼ぶ）を転移学習する．
1. こうして構築された性格モデルを用いて自由対話システムを構築し，システムの応答に外交的ないしは内向的な表現が現れるかの実験を行う．

- 各コーパスの情報
  - corpus_type : neutral
    - train_dataset : 408,272
    - val_dataset : 125,792
    - test_dataset : 54,098
  - corpus_type : neg
    - train_dialogue : 25,497 turns
    - val_dialogue : 7,649 turns
    - test_dialogue : 3,279 turns
  - corpus_type : pos
    - train_dialogue : 12,694 turns
    - val_dialogue : 3,808 turns
    - test_dialogue : 1,633 turns


```
dataloader_type : train
current epoch : 396
source : <s> ( 仕事 おちつい た ) </s>
target : <s>お疲れ様です!\(^o^)/</s>
preds : <s>お仕事してるの????????????????????????????????????????</s>
--------------------------
source : <s> お 疲れ 様 です ! \ (^o^) / </s>
target : <s>ありがとう!!!!干からびて死ぬかと思った!!</s>
preds : <s>ありがとうございます!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
--------------------------
source : <s> ありがとう ! ! ! ! 干からび て 死ぬ か と 思っ た ! ! </s>
target : <s>ハトムギ配合の美容液の風呂に使って水分補給しましょ!\(^o^)/</s>
preds : <s>おけおけ!!!私も来年は絶対行きたい</s>
--------------------------
source : <s> ハトムギ 配合 の 美容 液 の 風呂 に 使っ て 水分 補給 し ましょ ! \ (^o^) / </s>
target : <s>なにそれおしゃれ...!バブならある...!</s>
preds : <s>俺もタオルとかいいかもな......</s>
--------------------------
source : <s> モデリング お つよい </s>
target : <s>モデリングじゃないっす・・・制作キットってのがあって自作したのはテクスチャだけです・・・</s>
preds : <s><unk>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
--------------------------
source : <s> モデリング じゃ ない っす ・ ・ ・ 制作 キット って の が あっ て 自作 し た の は テクスチャ だけ です ・ ・ ・ </s>
target : <s>あーマジすか()</s>
preds : <s>あー</s>
--------------------------
source : <s> 流石 . . . 架空 鉄道 、 やっ て み た さ は 充分 ある ん だ けど 沼 り そう で 自制 し てる </s>
target : <s>←実際沼った自分はマイクラでやってたんですけど結局ネタ切れで挫折しましたねぇ架空鉄道ってのはやっぱりセンスとネタとの戦いかと</s>
preds : <s>推しは推しが決まってて嬉しいっていうのは正直ないと思うんだけどね</s>
--------------------------
source : <s> ← 実際 沼 っ た 自分 は マイクラ で やっ て た ん です けど 結局 ネタ切れ で 挫折 し まし た ねぇ 架空 鉄道 って の は やっぱり センス と ネタ と の 戦い か と </s>
target : <s>これマイクラか前から架空の地図とか書いてたしやってみたいんですけどねえ...</s>
preds : <s>これなら良いかな?</s>
--------------------------
source : <s> これ マイクラ か 前 から 架空 の 地図 と か 書い て た し やっ て み たい ん です けど ねえ . . . </s>
target : <s>地図あるならやりやすいかも・・・?</s>
preds : <s>自分ならやります!でもどこかでやってみますか?</s>
--------------------------
source : <s> 地図 ある なら やり やすい か も ・ ・ ・ ? </s>
target : <s>それはそうでもマイクラは準備めんどくさそうだなあ</s>
preds : <s>それはそうだね......</s>
--------------------------
source : <s> 私事 で は ござい ます が 本日 誕生 日 を 迎え まし た ! こんな の あっ た から 買っ て み た . . . ちっ つ ぁ い バーボン チャレンジ する なら 誕生 日 って 決め て た から ちょうど 良い . . . はず . . . ! 笑 </s>
target : <s>すみちゃん!!遅くなっちゃったけどおめでとうバーボンだ!!</s>
preds : <s>すみちゃん!!</s>

=================================


dataloader_type : test
current epoch : 396
source : <s> おぉ ー ! その 考え は 素敵 </s>
target : <s>らしいぞぃ沖縄の人はみんな言うど?</s>
preds : <s>前は素敵なところで何を言ってたんですか?</s>
--------------------------
source : <s> らしい ぞ ぃ 沖縄 の 人 は みんな 言う ど ? </s>
target : <s>来世はポジティブ思考の沖縄県民として生まれ分かりたい</s>
preds : <s>沖縄県人は誰だろ</s>
--------------------------
source : <s> はじまる 前 と は 違う ため息 、 、 まだ 夢 みたい で 不思議 、 、 </s>
target : <s><unk>やったね♡</s>
preds : <s>それは辛い、、、</s>
--------------------------
source : <s> <unk> やっ た ね ♡ </s>
target : <s>ドヒョン呼ばれた時点で完全に諦めてた、、、ほんと幸せすぎ</s>
preds : <s>もう少しでできるからたくさん話そ</s>
--------------------------
source : <s> ドヒョン 呼ば れ た 時点 で 完全 に 諦め て た 、 、 、 ほんと 幸せ すぎ </s>
target : <s>わたしも<unk>で諦めてたまさか上回るとは思わなかったよねmbk2人でデビュー感慨深い......</s>
preds : <s>そっか、、残念だったね</s>
--------------------------
source : <s> わたし も <unk> で 諦め て た まさか 上回る と は 思わ なかっ た よ ね mbk 2人 で デビュー 感慨 深い . . . . . . </s>
target : <s>ほんそれ、、mbk2人いるのはほんとに泣いちゃう、、追うしかねえよこれからもよろしくね!!!</s>
preds : <s>うんうん...私ももう<unk>は無理...でも<unk>は私は無理...</s>
--------------------------
source : <s> ほん それ 、 、 mbk 2人 いる の は ほんと に 泣い ちゃう 、 、 追う しか ねえ よ これ から も よろしく ね ! ! ! </s>
target : <s>よろしくね!!!x1活楽しも!!</s>
preds : <s><unk>ちゃんとは結婚した時の表情がたまらないよねっ!私も<unk>ちゃんと結婚したいっ!!!</s>
--------------------------
source : <s> よろしく ね ! ! ! x 1 活 楽 しも ! ! </s>
target : <s>これからが楽しみすぎて人生バラ色状態現場で会ってくれますか!?!?</s>
preds : <s>うん!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</s>
--------------------------
source : <s> これ から が 楽しみ すぎ て 人生 バラ色 状態 現場 で 会っ て くれ ます か ! ? ! ? </s>
target : <s>わかる5年生きれるぜひぜひ!!!!会いましょ!!!ショーケースとか楽しみすぎる</s>
preds : <s>現場監督「いやもう死んだぞ」俺らの現場ほしい</s>
--------------------------
source : <s> わかる 5 年 生きれる ぜひ ぜひ ! ! ! ! 会い ましょ ! ! ! ショーケース と か 楽しみ すぎる </s>
target : <s>生きれる頑張る理由できたひーん、嬉しい!!デビューは絶対行きたいけど平日だよなあお休み取れるかなあっていう心配が、、、、、、</s>
preds : <s>うんうん!会う!会う!会う!!会う!!!!</s>
--------------------------
source : <s> 生きれる 頑張る 理由 でき た ひー ん 、 嬉しい ! ! デビュー は 絶対 行き たい けど 平日 だ よ なあ お 休み 取れる か なあ って いう 心配 が 、 、 、 、 、 、 </s>
target : <s>ねー!仕事してるとそれが厳しいよね‍早めにスケジュール発表してほしい公式‍</s>
preds : <s>土日休みならよかったよね!!!!!!私も土日休みだったらそれはやばい...</s>
--------------------------

=================================


dataloader_type : train
current epoch : 398
source : <s> すみ ちゃん ! ! 遅く なっ ちゃっ た けど お めでとう バーボン だ ! ! </s>
target : <s>らぱんちゃん、ありがとうバーボンです!!でも、バーボンはまだ私には早すぎた...</s>
preds : <s>ありがとう</s>
--------------------------
source : <s> ら ぱん ちゃん 、 ありがとう バーボン です ! ! で も 、 バーボン は まだ 私 に は 早 すぎ た . . . </s>
target : <s>いえいえ!いいねまぁそういうこともあるよね......わかるよ......(お酒弱者による意見)</s>
preds : <s>いえいえ!お互い本当に良かった..............</s>
--------------------------
source : <s> いえ いえ ! いい ね まぁ そう いう こと も ある よ ね . . . . . . わかる よ . . . . . . ( お 酒 弱者 に よる 意見 ) </s>
target : <s>求:強くなる方法or一緒に飲んでくれる赤井秀一の気分だった笑</s>
preds : <s>ねー!だから酒好き笑</s>
--------------------------
source : <s> 求 : 強く なる 方法 or 一緒 に 飲ん で くれる 赤井 秀一 の 気分 だっ た 笑 </s>
target : <s>これは圧倒的後者なのでは......!?笑</s>
preds : <s>これは............................................................
--------------------------
source : <s> これ は 圧倒 的 後者 な の で は . . . . . . ! ? 笑 </s>
target : <s>え、大正解笑笑でも赤井さんがいても飲んでもらう説笑笑</s>
preds : <s>え、大丈夫なの?</s>
--------------------------
source : <s> え 、 大 正解 笑笑 で も 赤井 さん が い て も 飲ん で もらう 説 笑笑 </s>
target : <s>やったぜ('ω')弱いとそうなるよね笑でも憧れの存在が近くにいたらいくらでも飲める気がする\\\└('ω<unk>二日酔い所ではない)</s>
preds : <s>いないよ笑いやいやいや、普通に考えてないよ笑</s>
--------------------------
source : <s> やっ た ぜ ( ' ω ' ) 弱い と そう なる よ ね 笑 で も 憧れ の 存在 が 近く に い たら いくら で も 飲める 気 が する \\\└(' ω <unk> 二 日 酔い 所 で は ない ) </s>
target : <s>おめでとうございます。そんなラパンさんには赤井さんが飲んだバーボンの空ビンをプレゼント(いらない)なるなる笑笑あ、それも一理あるね赤井さんはどっちが好み←</s>
preds : <s>おめでとうございます(๑•̀ᄇ•́)و✧それはやばい笑ワインの香りはやばいよね</s>
--------------------------
source : <s> 知っ てる 方 は 知っ て いる で あろう これ 私 です の で 、 勝手 に 自分 名乗る の 辞め て ください 。 </s>
target : <s>これほいちゃんなの?www</s>
preds : <s>これからは僕を<unk>てください</s>
--------------------------
source : <s> これ ほい ちゃん な の ? www </s>
target : <s>わたしだよ</s>
preds : <s>そうです.......</s>
--------------------------
source : <s> わたし だ よ </s>
target : <s>なんかいっときすげー流れてたなたしかにこれww</s>
preds : <s>なんか面白いね</s>
--------------------------
source : <s> なん か いっとき すげー 流れ て た な たしか に これ ww </s>
target : <s>でしょ?wwwww高校の時の元彼が撮ってくれたやつなんだけどなぜかめっちゃバズった、名前は広まらなかったけど</s>
preds : <s>俺のやつもあった気がするw</s>
--------------------------

=================================


dataloader_type : test
current epoch : 398
source : <s> ねー ! 仕事 し てる と それ が 厳しい よ ね ‍ 早め に スケジュール 発表 し て ほしい 公式 ‍ </s>
target : <s>2ヶ月後くらいだよなあ休み取れるかなあしか考えられない行きたいのに行けないのが辛いよね</s>
preds : <s>ほんとそれよねとりあえずツアー決まってほしいね</s>
--------------------------
source : <s> 2 ヶ月 後 くらい だ よ なあ 休み 取れる か なあ しか 考え られ ない 行き たい の に 行け ない の が 辛い よ ね </s>
target : <s>調べたらわなわんも<unk>わんも月曜日にやってる......‍それが一番辛いやっぱこの目で見たいもんね</s>
preds : <s>そうなんよねーそうなんよねー2ヶ月後には2ヶ月あるからなぁ...</s>
--------------------------
source : <s> 調べ たら わ な わん も <unk> わん も 月曜 日 に やっ てる ......‍ それ が 一番 辛い やっぱ この 目 で 見 たい もん ね </s>
target : <s>だよね!?勝手に月曜のイメージだったの合ってたわ、、笑ワンチャン9月の3連休被れば余裕で行けるなーって思ってるから祈るしかない</s>
preds : <s>うん、(((*́艸`)))エヘヘいつか見てみたいぞ</s>
--------------------------
source : <s> だ よ ね ! ? 勝手 に 月曜 の イメージ だっ た の 合っ て た わ 、 、 笑 ワンチャン 9 月 の 3 連休 被れ ば 余裕 で 行ける なー って 思っ てる から 祈る しか ない </s>
target : <s>そっか!9月3連休2回もあるじゃん!!私も<unk></s>
preds : <s>確かに!日曜しかないよね確かに!日曜日にするか悩むよね私もその気持ちを伝えるのは大変だよねうんうんうん!それでも私も土日休みないからもうちょい早めに予定決めてほしい</s>
--------------------------
source : <s> そっ か ! 9 月 3 連休 2 回 も ある じゃん ! ! 私 も <unk> </s>
target : <s>ずみちゃ土日祝休み??わたし暦通りだから、こういう時はシフト休みが羨ましいまじで祈る死ぬほど祈る、、、</s>
preds : <s>これは!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</s>
--------------------------
source : <s> ず み ちゃ 土日 祝 休み ? ? わたし 暦 通り だ から 、 こう いう 時 は シフト 休み が 羨ましい まじ で 祈る 死ぬ ほど 祈る 、 、 、 </s>
target : <s>シフト制だけど社員だから何とも言えない<unk>日程出てたけど休み取れるか危うい早くてびっくり</s>
preds : <s><unk></s>
--------------------------
source : <s> シフト 制 だ けど 社員 だ から 何 と も 言え ない <unk> 日程 出 て た けど 休み 取れる か 危うい 早く て びっくり </s>
target : <s>辛いでしかないね、、わたしもほぼアウト1ヶ月って早すぎん??</s>
preds : <s>俺もそうして会社に電話してもらうしかねえなこれ</s>
--------------------------
source : <s> 辛い で しか ない ね 、 、 わたし も ほぼ アウト 1 ヶ月 って 早 すぎ ん ? ? </s>
target : <s>辛い生中継期待しよ......早すぎるよね!!!!メンバーのスケジュールやばそう</s>
preds : <s>ワイも2ヶ月やけど全然落ちてなくて今はもうきつい、、</s>
--------------------------
source : <s> 辛い 生 中継 期待 し よ . . . . . . 早 すぎる よ ね ! ! ! ! メンバー の スケジュール や ば そう </s>
target : <s>やるよね絶対、、画面越しで我慢するしかねぇな、、ほんとだよ、<unk>の倍以上時間あるんだからゆっくりいきーやーって</s>
preds : <s>ほんとそれ...!!!ほんと楽しみすぎる!!!!!!!!!!!!!!!!!!!!!!!!!!</s>
--------------------------
source : <s> やる よ ね 絶対 、 、 画面 越し で 我慢 する しか ねぇ な 、 、 ほんと だ よ 、 <unk> の 倍 以上 時間 ある ん だ から ゆっくり いき ー やー って </s>
target : <s>画面越しにペンラ<unk>......だよねこの調子だと怒涛の5年間になりそう</s>
preds : <s>1日でも1日ずつだからね、1日でもあるのを待つのを待つのも大変だからね(;∀;)その分その気持ちが嬉しいって思う(;∀;)</s>
--------------------------
source : <s> 画面 越し に ペンラ <unk> . . . . . . だ よ ね この 調子 だ と 怒涛 の 5 年間 に なり そう </s>
target : <s>追うの忙しすぎて有休無くなってお金もなくなる5年後見えた、、ラスコンで大号泣する自分まで見えた、、</s>
preds : <s>5話くらいになってるってことは5話???????????????????<unk><unk><unk><unk>..............</s>
--------------------------

=================================
```